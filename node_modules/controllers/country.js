var db = require('controllers/database');
var mongoose = require('mongoose');
var countrys = mongoose.model('countrys');

exports.getAllCountry = function(callback){
	/*countrys.find({},function(err,data){
		if(data.length != null){
			callback({'res':true,'data':data});
		}else{
			callback({'res':false});
		}
	});*/
	countrys.find({},{_id:0,name:1},function(err,data){
		if(data.length != null){
			callback({'res':true,'data':data});
		}else{
			callback({'res':false});
		}
	}).sort({name:1});
}
// TODO: add new country
exports.setCountry = function(callback){
  countrys.insert({user:'sal'},function(err){
		if(err){
			callback({'res':false});
		}else {
			callback({'res':true});
		}
  });
}

exports.getAllCity = function(name,callback){
	/*countrys.find({name:name},function(err,data){
		if(data.length != null){
			callback({'res':true,'data':data[0].city});
		}else{
			callback({'res':false});
		}
	});*/
	countrys.aggregate({$unwind:'$city'},{$match:{name:name}},{$sort:{'city.name':1}},function(err,data){
		if(data.length != null){
			var dataCity = [];
      for (i = 0; i < data.length; i++) {
        dataCity.push({ 'name':data[i].city.name });
      }
			callback({'res':true,'data':dataCity});
		}else{
			callback({'res':false});
		}
	});
}
